@page "{id?}"
@model DnsProxy.Pages.Rules.EditModel
@using DnsProxy.Models;
EditModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = "_Layout";   // берётся Pages/Shared/_Layout.cshtml
}
<h2>@(Model.Item.Id==0?"Новое правило":"Редактирование")</h2>

<form method="post" class="row g-3">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Item.Id" />          <!-- ❶ сохраняем Id при редактировании -->

    <div class="col-md-4">
        <label asp-for="Item.SourceIp" class="form-label"></label>
        <input asp-for="Item.SourceIp" class="form-control" placeholder="* (все IP)"/>
    </div>

    <div class="col-md-4">
        <label asp-for="Item.DomainPattern" class="form-label"></label>
        <input asp-for="Item.DomainPattern" class="form-control" />
    </div>

    <div class="col-md-4">
        <label asp-for="Item.Action" class="form-label"></label>
        <select asp-for="Item.Action" class="form-select"
                asp-items="Html.GetEnumSelectList<RuleAction>()"></select>
    </div>

  <div class="col-md-6">
    <label asp-for="Item.RewriteIp" class="form-label"></label>
    <input asp-for="Item.RewriteIp" class="form-control"/>
  </div>

    <div class="col-md-6">
        <label class="form-label">Форсировать сервер</label>
        <select name="force" class="form-select">
            <option value="">— не форсировать —</option>
            @foreach (var opt in Model.ServerOptions)
            {
                <option value="@opt.Value" selected="@(opt.Value==Model.Item.IncludeServers ? "selected":null)">
                    @opt.Text
                </option>
            }
        </select>
    </div>

    <!-- ⭐ Разрешить список -->
    <div class="col-md-6">
        <label class="form-label">Разрешить только</label>
        <select multiple name="include" class="form-select" size="4">
            @foreach (var o in Model.ServerOptions)
            {
                <option value="@o.Value"
                        selected="@(Model.Item.IncludeServers?.Split(',').Contains(o.Value)??false)">
                    @o.Text
                </option>
            }
        </select>
        <small class="text-muted">Если не выбрано — допускаются все.</small>
    </div>

    <!-- ⭐ Запретить -->
    <div class="col-md-6">
        <label class="form-label">Запретить серверы</label>
        <select multiple name="exclude" class="form-select" size="4">
            @foreach (var o in Model.ServerOptions)
            {
                <option value="@o.Value"
                        selected="@(Model.Item.ExcludeServers?.Split(',').Contains(o.Value)??false)">
                    @o.Text
                </option>
            }
        </select>
    </div>

  <button class="btn btn-success w-25">Сохранить</button>
  <a asp-page="Index" class="btn btn-secondary">Отмена</a>
</form>
